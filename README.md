<div>
  <img src="https://avatars.githubusercontent.com/u/187389012?s=200&v=4" alt="NYU AD Logo">
</div>

# MigMate

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## Project Information

MigMate is a plugin that integrates PyMigTool into Visual Studio Code. [PyMigTool](https://github.com/sanadlab/PyMigTool) is a CLI tool that allows users to automate the migration of Python libraries by adding pre-processing and post-processing to an LLM-powered migration.

## Table of Contents

  - [Project Setup](#project-setup)
    - [Prerequisites](#prerequisites)
    - [Installation](#install-and-run)
    - [Packaging](#packaging)
  - [Usage](#usage)
    - [Overview](#overview)
    - [Plugin Activation](#plugin-activation)
    - [Set API Key](#set-api-key)
    - [Initiate a Migration](#initiate-a-migration)
    - [Configuration](#configuration)
  - [Telemetry](#telemetry)

## Project Setup

### Prerequisites

1. Install [Node.js](https://nodejs.org/en/download), [Git](https://git-scm.com/downloads), [Python](https://www.python.org/downloads/), and [Visual Studio Code](https://code.visualstudio.com/download)
2. Follow [PyMigTool's installation instructions](https://github.com/sanadlab/PyMigTool?tab=readme-ov-file#installation)

### Install and Run

1. Clone the repo

```bash
   git clone <repo>
```

2. Navigate to the cloned directory

3. Install dependencies

```bash
   npm install
```

4. Open Visual Studio Code

```bash
   code .
```

5. Build and Run the Extension
  - Press `F5` in VS Code to launch a new Extension Development Host window
  - This should automatically build the extension and load it, but if it doesn't you can try `npm run compile` from the command line.

### Packaging

If you would prefer to package the extension locally, follow these steps instead of running the plugin through the Extension Development Host.

1. Install [vsce](https://github.com/microsoft/vscode-vsce) (Visual Studio Code Extensions)

```bash
   npm install -g @vscode/vsce
```

2. Package the extension as a VSIX file

```bash
   npx @vscode/vsce package
```

2. Install the packaged extension through the command line or VS Code (`Extensions: Install from VSIX...`)

```bash
   code --install-extension <filename>.vsix
```

## Usage

### Overview

With VS Code open and the extension running, you can now use the plugin's commands (make sure you are in the right VS Code window if using the Extension Development Host). Press `CTRL+SHIFT+P` to access the Command Palette. You can also see [VS Code Extension Quickstart](./docs/vsc-extension-quickstart.md) for more information on extension basics.

Commands:
- MigMate: Migrate a Library
- MigMate: View Migration Test Results
- MigMate: Set API Keys to be Stored

### Plugin Activation

The plugin will be activated after invoking any commands through the Command Palette

- Languages: `python`, `pip-requirements`
- Workspace Files: `requirements.txt`, `pyproject.toml`

### Set API Key

PyMigTool currently supports OpenAI models, and will look for an `OPENAI_API_KEY` environment variable. You can save your API key by using the `MigMate: Set API Keys to be Stored` and selecting OpenAI, then pasting your key in. The key is stored using VS Code's [SecretStorage API](https://code.visualstudio.com/api/references/vscode-api#SecretStorage). Alternatively, you may also be able to manually set the appropriate environment variable.

### Initiate a Migration

- Open the Command Palette (`CTRL+SHIFT+P`) and select `MigMate: Migrate a Library`
- Right click within the editor (while in `requirements.txt`) and click 'Migrate a Library' to initiate a migration without opening the command palette. A Quick Pick menu will prompt you to select a source library from those detected, followed by a target library.
- Hover over a library in `requirements.txt` to initiate a migration using it as the chosen source library. The following Quick Pick will only ask for a target library.

### Configuration

Configuration options can be set through VS Code's *Settings* interface or a local *settings.json* file. The `Flag` category corresponds to the [CLI flags accepted by PyMigTool](https://code.visualstudio.com/api/references/vscode-api#SecretStorage), while the `Options` category modifies the plugin UI and behavior. The current options are as follows:

- Show CLI Output - show the console output generated by PyMigTool during migrations (`False` by default)
- Preview on Migration Failure - allow previews to be shown in the event of post-migration failures (`False` by default)
- Enable Suggestions (Experimental) - allow for basic querying to Libraries.io to suggest target libraries (`False` by default, requires an API key)
- Preview Style - choose between the Refactor Preview and a custom Webview to display migration previews (`Webview` by default)

## Telemetry

Migmate uses the [@vscode/extension-telemetry](https://www.npmjs.com/package/@vscode/extension-telemetry) module to optionally collect usage data. The collection of data respects the central `isTelemetryEnabled` and `telemetry.telemetryLevel` settings used by VS Code.
